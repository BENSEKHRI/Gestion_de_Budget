{% extends 'base.html.twig' %}

{% block title %}Work Flow{% endblock %}

{% block body %}


<head>

    <meta content="" name="keywords">
    <meta content="" name="description">
    
</head>


<body>
<!-- Table Start -->
{{ include('_navbar.html.twig') }}
<div class="container-fluid pt-0 px-3">
    <div class="row g-4">
        <div class="col-12">
            <div class="bg-light rounded h-100 p-4">
                <div class="mb-3">
                    <h3 class="text-center text-uppercase">Saisie Budgétaire</h3>
                </div>

                <div class="table-responsive col-4 mx-auto">
                    <table class="table table-bordered">
                        {{form_start(form)}}
                            <tr>
                                <td class="text-center align-middle">Géographie</td>
                                <td>{{ form_widget(form.geographie) }}</td>
                                <td class ="align-middle"><button type="submit" class="btn btn-outline-warning rounded-pill"><i class="bi bi-search"></i></button></td>

                            </tr>
                            <tr>
                                <td class="text-center align-middle">Canal</td>
                                <td>{{ form_widget(form.canal) }}</td>
                                <td><a href="{{ path('app_budget_nouvelle_ligne')}}" class="btn btn-outline-success rounded-pill"><i class="fa fa-solid fa-plus"></i></a></td>
                            </tr>
                            
                        {{form_end(form)}}
                    </table>
                </div>

                <div class="table-responsive align-middle text-center">

                    {% for fait in faits %}
                        {% if not (faits is empty) %}
                    <table class="table table-bordered">
                        <thead>
                            <tr class="table">
                                <th scope="col" colspan="2"rowspan="2"></th>
                                <th scope="col" colspan="3" class="table-danger text-center">{{ fait.date|date('M/Y') }}</th>
                                
                            </tr>

                            <tr class= "table">
                                <th scope="col" class="table-danger">Actual</th>
                                <th scope="col" class="table-danger">Budget</th>
                                <th scope="col" class="table-danger">Variance</th>
                            </tr>
                        </thead>
                        <tbody>
                            {# On boucle sur les lignes des faits #}
                            

                                <tr>
                                    <th class="table-danger">{{ fait.produit.getNomProduit()|capitalize }}</th>
                                    <th class="table-danger">Price</th>
                                    <td class="table-warning">{{ fait.actual }} €</td>
                                    <td class="table-success">{{ fait.budget }} €</td>
                                    {% set variance = fait.actual-fait.budget %}
                                    <td class="table-info">{{ variance }} €</td>

                                    <td> 
                                        <a href="{{ path('app_budget_modifier_ligne', {'id':fait.id}) }}" class="btn btn-outline-info rounded-pill"><i class="fa fa-solid fa-wrench"></i></a> 
                                        <a href="{{ path('app_budget_supprimer_ligne', {'id':fait.id}) }}" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette ligne ?');" class="btn btn-outline-danger rounded-pill"><i class="fa fa-solid fa-minus"></i></a>                                             
                                    </td>
                                </tr>
                        </tbody>
                    </table>
                    {% else %}
                        Il n'y a aucune ligne dans votre grille budgétaire. 
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Table End -->
</body>
{% endblock %}
